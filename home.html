<!DOCTYPE html>
<html>
<head>
        <title>Events Search</title>
</head>
<body>
<!-- 
<h2>Grouping Form Data with Fieldset</h2>
<p>The fieldset element is used to group related data in a form, and the legend element defines a caption for the fieldset element.</p>
 -->

<!-- <form action="/action_page.php"> -->
  <fieldset>
    <legend>Search events:</legend>
    Location:<br>
    <input type="text" id="location">
    <br>
    Start time:<br>
    <input type="date" name="start" id="startdate">
    <br>
    End time:<br>
    <input type="date" name="end" id="enddate">
    <br>
    Events Keywords:<br>
    <input type="text" id="event">
    <h1 id="output"></h1>
    <br>

   <button onclick="loadDoc()" > Find Events </button>
      <!-- <script type="text/javascript" src="send.js"></script> -->
        <script>

        function returnDateString(cur){
                  // document.getElementById('output').innerHTML = cur;
                  var dt = new Date(cur);                        
                  var dat=dt.getDate();
                  var mn=dt.getMonth();
                  // mn++;
                  var yy=dt.getFullYear();
                  var final_mn = "";
                  var final_date = "";
                  var months = [ "January", "February", "March", "April", "May", "June", 
                 "July", "August", "September", "October", "November", "December" ];
                  if (dat<10) {
                       final_dat = "0"+dat;  
                  }
                  else{
                      final_dat = dat;
                  }
                  return yy+"-"+ months[mn] +"-"+final_dat;
        }

        function check(str){
            var dt = new Date(str);                        
            var dat=dt.getDate();
            var mn=dt.getMonth();
            mn++;
            var yy=dt.getFullYear();
            var final_mn = "";
            var final_date = "";
            if (mn<10) {
                 final_mn = "0"+mn;  
            }
            else{
                final_mn = mn;
            }

            if (dat<10) {
                 final_dat = "0"+dat;  
            }
            else{
                final_dat = dat;
            }
            return yy+"-"+final_mn+"-"+final_dat;
        }
        window.onload = function() {
            
            var cur = Date.now();
            // document.getElementById('output').innerHTML = cur;
            var dt = new Date(cur);                        
            var dat=dt.getDate();
            var mn=dt.getMonth();
            mn++;
            var yy=dt.getFullYear();
            var final_mn = "";
            var final_date = "";
            if (mn<10) {
                 final_mn = "0"+mn;  
            }
            else{
                final_mn = mn;
            }

            if (dat<10) {
                 final_dat = "0"+dat;  
            }
            else{
                final_dat = dat;
            }
            // // document.getElementById('output').innerHTML = yy+"-"+final_mn+"-"+final_dat;
            // document.getElementById("startdate").value = yy+"-"+final_mn+"-"+final_dat;
            // document.getElementById("enddate").value = yy+"-"+final_mn+"-"+final_dat;

            document.getElementById("startdate").value = check(returnDateString(cur));
            document.getElementById("enddate").value = check(returnDateString(cur));

        }


        function loadDoc() {
            var location = document.getElementById('location').value;
            var startdate = document.getElementById("startdate").value;            
            var enddate = document.getElementById("enddate").value;
            var event = document.getElementById('event').value;
            var send_string = "{\
                \"startdate\":"+startdate+",\
                \"enddate\":"+enddate+",\
                \"event\":"+event+",\
                \"location\":"+location+"\
            }"
            // document.getElementById('output').innerHTML = send_string;

          // var xhttp = new XMLHttpRequest();          
          // alert("here");

          // xhttp.open("POST", "http://10.194.32.206:8080/query_handle/loginServlet", false);
          // // xhttp.open("GET", "http://10.194.32.206:8080/query_handle/loginServlet?info='kay'", false);
          // xhttp.setRequestHeader( 'Access-Control-Allow-Origin', '*');
          // xhttp.send(send_string);
          // console.log("info",xhttp.responseText);
          // document.getElementById('output').innerHTML = "[{\"date\":\"2-4-1998\",\"location\":\"Chennai\",\"info\":\"haswee.com\" }]";
           // global_object = "[{\"date\":\"2-4-1998\",\"location\":\"Chennai\",\"info\":\"haswee.com\" }]";

          var jsonObject = [
          {
            "id":"1",
            "date":"1-10-2010",
            "location":"Pangong Lake, Kashmir",
            "info":"google.com"
          },
          {
            "id":"2",
            "date":"10-10-2010",
            "location":"Kupwara, Kashmir",
            "info":"google.com"
          },
          {
            "id":"3",
            "date":"1-10-2019",
            "location":"Leh, Kashmir",
            "info":"fb.com"
          },
          {
            "id":"4",
            "date":"10-01-2005",
            "location":"Udhampur, Kashmir",
            "info":"google.com"
          },
          {
            "id":"5",
            "date":"05-05-2014",
            "location":"Katra, Kashmir",
            "info":"google.com"
          },
          {
            "id":"6",
            "date":"08-18-2016",
            "location":"Kargil, Kashmir",
            "info":"google.com"
          },
          {
            "id":"7",
            "date":"09-12-2010",
            "location":"Ramban, Kashmir",
            "info":"google.com"
          },
          {
            "id":"8",
            "date":"04-20-2019",
            "location":"Pulwama, Kashmir",
            "info":"google.com"
          }
          ];
            // global_object = "[{ \"id\":\"1\",\"date\":\"1-1-2017\",\"location\":\"Kupwara\",\"info\":\"google.com\"},{\"id\":\"2\",\"date\":\"1-2-2009\",\"location\":\"Hyderabad\",\"info\":\"fb.com\"},{\"id\":\"3\",\"date\":\"1-3-2004\",\"location\":\"Singapore\",\"info\":\"nus.com\"}]";      
            // var  global_object = xhttp.responseText;
            
            // var myArr = JSON.parse(global_object);
            var myArr = jsonObject;
            myArr.sort(function(a,b){
                var c = new Date(a["date"]);
                var d = new Date(b["date"]);
                return c-d;
                });
            document.getElementById('output').innerHTML = JSON.stringify(myArr);
            // document.getElementById('output').innerHTML = new Date(myArr[myArr.length -1]["date"]);
           // var url = 'Events_Map.html?object='+encodeURIComponent(JSON.stringify(myArr));
           var url = 'Events_Map_with_timeline_disappear.html?object='+encodeURIComponent(JSON.stringify(myArr));
           document.location.href = url;

           
        }

            </script>

  </fieldset>


<!-- </form> -->


</body>
</html>
